[gcode_macro SET_FILAMENT]
gcode:
  {% set nozzle_diameter = params.NOZZLE|default(0.4)|float %}
  {% set filament_type = params.TYPE|default("PETG_SOVETOV") %}
  RESET_VELOCITY
  {% if "gcode_macro SET_FILAMENT_" + filament_type in printer %}
  SET_FILAMENT_{filament_type} NOZZLE={nozzle_diameter}
  {% else %}
  M118 Warning! Filament settings missing for {filament_type}. Loading default ones.
  SET_FILAMENT_PETG_SOVETOV NOZZLE={nozzle_diameter}
  {% endif %}

[gcode_macro SET_FILAMENT_TPU_FDPLAST]
gcode:
  {% set nozzle_diameter = params.NOZZLE|default(0.4)|float %}
  {% if nozzle_diameter == 0.4 %}
  SET_PRESSURE_ADVANCE ADVANCE=0.0 SMOOTH_TIME=0.01
  SET_RETRACTION RETRACT_LENGTH=2.0 RETRACT_SPEED=25 UNRETRACT_SPEED=25
  {% else %}
  M118 Unhandled nozzle size!
  {% endif %}

[gcode_macro SET_FILAMENT_PLA_U3]
gcode:
  {% set nozzle_diameter = params.NOZZLE|default(0.4)|float %}
  {% if nozzle_diameter == 0.6 %}
  SET_PRESSURE_ADVANCE ADVANCE=0.015 SMOOTH_TIME=0.01
  SET_RETRACTION RETRACT_LENGTH=0.3 RETRACT_SPEED=40 UNRETRACT_SPEED=50
  {% else %}
  M118 Unhandled nozzle size!
  {% endif %}

[gcode_macro SET_FILAMENT_PLA_SOVETOV]
gcode:
  {% set nozzle_diameter = params.NOZZLE|default(0.4)|float %}
  {% if nozzle_diameter == 1.2 %}
  SET_PRESSURE_ADVANCE ADVANCE=0.002 SMOOTH_TIME=0.01
  SET_RETRACTION RETRACT_LENGTH=1.5 RETRACT_SPEED=30 UNRETRACT_SPEED=35
  {% elif nozzle_diameter == 1.0 %}
  SET_PRESSURE_ADVANCE ADVANCE=0.005 SMOOTH_TIME=0.01
  SET_RETRACTION RETRACT_LENGTH=1.5 RETRACT_SPEED=30 UNRETRACT_SPEED=35
  {% elif nozzle_diameter == 0.8 %}
  SET_PRESSURE_ADVANCE ADVANCE=0.015 SMOOTH_TIME=0.01
  SET_RETRACTION RETRACT_LENGTH=0.8 RETRACT_SPEED=30 UNRETRACT_SPEED=45
  {% elif nozzle_diameter == 0.6 %}
  SET_PRESSURE_ADVANCE ADVANCE=0.03 SMOOTH_TIME=0.01
  SET_RETRACTION RETRACT_LENGTH=0.8 RETRACT_SPEED=20 UNRETRACT_SPEED=30
  {% elif nozzle_diameter == 0.4 %}
  SET_PRESSURE_ADVANCE ADVANCE=0.035 SMOOTH_TIME=0.01
  SET_RETRACTION RETRACT_LENGTH=0.6 RETRACT_SPEED=40 UNRETRACT_SPEED=50
  {% elif nozzle_diameter == 0.2 %}
  SET_PRESSURE_ADVANCE ADVANCE=0.04 SMOOTH_TIME=0.03
  SET_RETRACTION RETRACT_LENGTH=0.6 RETRACT_SPEED=40 UNRETRACT_SPEED=40
  {% endif %}

[gcode_macro SET_FILAMENT_PETG_CHINA]
gcode:
  SET_PRESSURE_ADVANCE ADVANCE=0.03 SMOOTH_TIME=0.01
  SET_RETRACTION RETRACT_LENGTH=0.6 RETRACT_SPEED=30 UNRETRACT_SPEED=50

[gcode_macro SET_FILAMENT_PETG_SOVETOV]
gcode:
  {% set nozzle_diameter = params.NOZZLE|default(0.4)|float %}
  {% if nozzle_diameter == 1.2 %}
  SET_PRESSURE_ADVANCE ADVANCE=0.002 SMOOTH_TIME=0.01
  SET_RETRACTION RETRACT_LENGTH=1.5 RETRACT_SPEED=30 UNRETRACT_SPEED=35
  {% elif nozzle_diameter == 1.0 %}
  SET_PRESSURE_ADVANCE ADVANCE=0.005 SMOOTH_TIME=0.01
  SET_RETRACTION RETRACT_LENGTH=1.5 RETRACT_SPEED=30 UNRETRACT_SPEED=35
  {% elif nozzle_diameter == 0.8 %}
  SET_PRESSURE_ADVANCE ADVANCE=0.015 SMOOTH_TIME=0.01
  SET_RETRACTION RETRACT_LENGTH=0.8 RETRACT_SPEED=30 UNRETRACT_SPEED=45
  {% elif nozzle_diameter == 0.6 %}
  SET_PRESSURE_ADVANCE ADVANCE=0.03 SMOOTH_TIME=0.01
  SET_RETRACTION RETRACT_LENGTH=0.6 RETRACT_SPEED=40 UNRETRACT_SPEED=50
  {% elif nozzle_diameter == 0.4 %}
  SET_PRESSURE_ADVANCE ADVANCE=0.035 SMOOTH_TIME=0.01
  SET_RETRACTION RETRACT_LENGTH=0.6 RETRACT_SPEED=40 UNRETRACT_SPEED=50
  {% elif nozzle_diameter == 0.2 %}
  SET_PRESSURE_ADVANCE ADVANCE=0.22 SMOOTH_TIME=0.03
  SET_RETRACTION RETRACT_LENGTH=0.8 RETRACT_SPEED=40 UNRETRACT_SPEED=50
  {% endif %}

[gcode_macro SET_FILAMENT_PA_STROY]
gcode:
  {% set nozzle_diameter = params.NOZZLE|default(0.4)|float %}
  SET_PRESSURE_ADVANCE ADVANCE=0.03 SMOOTH_TIME=0.01
  SET_RETRACTION RETRACT_LENGTH=0.5 RETRACT_SPEED=20 UNRETRACT_SPEED=25